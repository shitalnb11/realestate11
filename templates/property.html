{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ property.title }} - Property Details</title>

  <!-- Google Fonts & Bootstrap -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/COMPANY22.PNG' %}">
  <link rel="stylesheet" href="{% static 'css/property.css' %}">
  <link rel="stylesheet" href="{% static 'css/nav.css' %}">
</head>
<body>

<!-- ✅ Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">
      <img src="{% static 'img/logo1.png' %}" alt="Real Estate" height="50" />
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
        <li class="nav-item"><a class="nav-link active" href="{% url 'properties' %}">Properties</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'contact' %}">Contact</a></li>
        {% if user.is_authenticated %}
        <form action="{% url 'logout' %}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-link nav-link" style="text-decoration:none;">Logout</button>
        </form>
        {% else %}
        <li class="nav-item">
          <a class="nav-link" href="{% url 'login' %}">Login/Register</a>
        </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<div class="property-wrapper">

  <!-- Hero Section -->
  <section class="hero">
    {% if property.image %}
      <img src="{{ property.image.url }}" alt="{{ property.title }}" class="hero-img">
    {% else %}
      <img src="{% static 'img/propcard.jpg' %}" alt="Property Hero" class="hero-img">
    {% endif %}
    <div class="overlay"></div>
    <div class="hero-text">
      <h1>{{ property.title }}</h1>
      <p><i class="fas fa-map-marker-alt"></i> {{ property.location }}</p>
    </div>
  </section>

  <!-- Property Info -->
  <section class="info-card glass-card">
    <h2><i class="fas fa-building"></i> Property Overview</h2>
    <div class="info-content">
      <div class="info-text">
        <div class="info-grid">
          <p><i class="fas fa-user-hard-hat"></i> <strong>Builder:</strong> {{ property.builder_name }}</p>
          <p><i class="fas fa-phone"></i> <strong>Contact:</strong> {{ property.contact_number }}</p>
          <p><i class="fas fa-ruler-combined"></i> <strong>Area:</strong> {{ property.area }} sq.ft</p>
          <p><i class="fas fa-star text-warning"></i> 
            <strong>Average Rating:</strong> {{ average_rating|floatformat:1 }}/5 ⭐
          </p>
        </div>
        <p class="description"><i class="fas fa-info-circle"></i> 
          <strong>Description:</strong> {{ property.description }}
        </p>
      </div>

      <div class="info-image">
        {% if property.image %}
          <img src="{{ property.image.url }}" alt="{{ property.title }}">
        {% else %}
          <img src="{% static 'img/Mumbai.png' %}" alt="Property Overview">
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Ratings Section -->
  <section class="ratings glass-card">
    <h2><i class="fas fa-star"></i> User Ratings</h2>
    <div class="rating-summary">
      <h3>{{ average_rating|floatformat:1 }}/5</h3>
      <div class="stars">
        {% for i in "12345" %}
          {% if forloop.counter <= average_rating %}
            <i class="fas fa-star text-warning"></i>
          {% else %}
            <i class="far fa-star text-muted"></i>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <form method="POST">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary mt-2">Submit Rating</button>
    </form>

    <hr>
    <h4>Recent Ratings:</h4>
    {% for r in ratings %}
      <div class="single-rating">
        <strong>{{ r.user.username }}</strong> rated 
        <span class="text-warning">{{ r.rating }}/5</span>
        <p>{{ r.comment }}</p>
        <small class="text-muted">{{ r.created_at|date:"M d, Y" }}</small>
      </div>
      <hr>
    {% empty %}
      <p>No ratings yet. Be the first to review!</p>
    {% endfor %}
  </section>

  <!-- Map Section -->
  <section class="map glass-card">
    <h2><i class="fas fa-map-location-dot"></i> Location Map</h2>
    <iframe 
      width="100%" 
      height="400" 
      frameborder="0" 
      style="border:0"
      src="https://www.google.com/maps?q={{ property.location|urlencode }}&output=embed"
      allowfullscreen>
    </iframe>
  </section>

</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
