{% extends 'base.html' %}
{% load static %}
{% block title %}Register - Real Estate{% endblock %}

{% block content %}
<div class="register-wrapper mt-5">
  <!-- LEFT -->
  <div class="register-left">
    <div class="left-overlay"></div>
    <div class="left-content">
      <h5>Join the Best Property Platform</h5>
      <p>Sign up now and explore thousands of properties with ease.</p>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="register-right">
    <h3>Create Your Account</h3>
    <p class="text-muted mb-4">Sign up to get started</p>

    <!-- ✅ Django messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <!-- ✅ Form -->
    <form id="registerForm" class="needs-validation" method="POST" novalidate>
      {% csrf_token %}

      <div class="mb-3 position-relative">
        <span class="input-icon"><i class="bi bi-person"></i></span>
        <input type="text" name="full_name" id="fullName" class="form-control"
          placeholder="Full Name" minlength="3" pattern="^[A-Za-z\s]+$" required>
        <div class="invalid-feedback">⚠️ Please enter a valid full name (letters only).</div>
      </div>

      <div class="mb-3 position-relative">
        <span class="input-icon"><i class="bi bi-envelope"></i></span>
        <input type="email" name="email" id="email" class="form-control"
          placeholder="Your Email" required>
        <div class="invalid-feedback">⚠️ Please enter a valid email address.</div>
      </div>

      <div class="mb-3 position-relative">
        <span class="input-icon"><i class="bi bi-telephone"></i></span>
        <input type="tel" name="phone" id="phone" class="form-control"
          placeholder="Phone Number" pattern="^[0-9]{10}$" required>
        <div class="invalid-feedback">⚠️ Please enter a 10-digit phone number.</div>
      </div>

      <div class="mb-3 position-relative">
        <span class="input-icon"><i class="bi bi-lock"></i></span>
        <input type="password" name="password1" id="password1" class="form-control"
          placeholder="Password" minlength="6" required>
        <span class="eye-icon" id="togglePass"><i class="bi bi-eye"></i></span>
        <div class="invalid-feedback">⚠️ Password must be at least 6 characters long.</div>
      </div>

      <div class="mb-3 position-relative">
        <span class="input-icon"><i class="bi bi-lock-fill"></i></span>
        <input type="password" name="password2" id="password2" class="form-control"
          placeholder="Confirm Password" required>
        <div class="invalid-feedback" id="confirmFeedback">⚠️ Passwords do not match.</div>
      </div>

      <button class="btn btn-register w-100" type="submit">Register</button>

      <div class="text-center mt-3">
        Already have an account? <a href="{% url 'login' %}" class="text-decoration-none text-primary">Login</a>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("registerForm");
  const password1 = document.getElementById("password1");
  const password2 = document.getElementById("password2");
  const toggle = document.getElementById("togglePass");

  // ✅ Hide validation at start (page load)
  form.classList.remove("was-validated");

  // ✅ Toggle password visibility
  toggle.addEventListener("click", () => {
    const type = password1.type === "password" ? "text" : "password";
    password1.type = password2.type = type;
    toggle.innerHTML = type === "password" ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
  });

  // ✅ Validate only when user clicks Submit
  form.addEventListener("submit", (event) => {
    let valid = true;

    // HTML5 validation
    if (!form.checkValidity()) {
      valid = false;
    }

    // Password match validation
    if (password1.value !== password2.value) {
      password2.setCustomValidity("Passwords do not match");
      valid = false;
    } else {
      password2.setCustomValidity("");
    }

    if (!valid) {
      event.preventDefault();
      event.stopPropagation();
      form.classList.add("was-validated"); // ✅ show validation only now
    }
  });

  // ✅ Hide red borders while typing
  form.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", () => {
      input.classList.remove("is-invalid", "is-valid");
    });
  });
});
</script>
{% endblock %}
